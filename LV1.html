<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spanish Quest-Level 1</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
    #overlay {
      position: fixed;
      width: 100%;
      height: 100%;
      background: black;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s;
    }
  </style>
</head>
<body>
  <div id="overlay"></div>
  <canvas id="gameCanvas"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const overlay = document.getElementById("overlay");
    
    // Canvas setup
    canvas.width = 800;
    canvas.height = 400;
    const VIEWPORT_MARGIN = 200; // Distance from right edge to generate new content
    
    // Game state
    let isDead = false;
    let fadeAlpha = 0;
    let cameraX = 0;
    const LEVEL_END_X = 5000; // Total level length
    let lastPlatformX = 0;
    
    // Player setup
    const player = {
      x: 50,
      y: 300,
      width: 40,
      height: 60,
      color: "black",
      headColor: "beige",
      velocityX: 0,
      velocityY: 0,
      speed: 5,
      isJumping: false,
    };

    // Level elements
    const blocks = generateInitialPlatforms();
    const enemies = [];
    const cave = {
      x: LEVEL_END_X - 100,
      y: canvas.height - 150,
      width: 80,
      height: 100
    };

    function generateInitialPlatforms() {
      const platforms = [];
      // Starting platform
      platforms.push({ x: 0, y: canvas.height - 50, width: 200, height: 20 });
      return platforms;
    }

    function generatePlatform() {
      const minX = lastPlatformX + 200;
      const maxX = lastPlatformX + 400;
      const x = Math.floor(Math.random() * (maxX - minX)) + minX;
      
      const minY = canvas.height - 300;
      const maxY = canvas.height - 100;
      const y = Math.floor(Math.random() * (maxY - minY)) + minY;
      
      const width = Math.floor(Math.random() * 150) + 100;
      
      const newPlatform = { x, y, width, height: 20 };
      blocks.push(newPlatform);
      lastPlatformX = x;
      
      // Generate enemy on this platform 30% of the time
      if (Math.random() < 0.3) {
        enemies.push({
          x: x + width/2 - 16,
          y: y - 32,
          width: 32,
          height: 32,
          platform: newPlatform
        });
      }
    }

    function checkEnemyCollisions() {
      enemies.forEach(enemy => {
        if (checkCollision(player, enemy)) {
          handleDeath();
        }
      });
    }

    function updateGeneration() {
      const rightEdge = cameraX + canvas.width;
      while (lastPlatformX < rightEdge + VIEWPORT_MARGIN && lastPlatformX < LEVEL_END_X - 500) {
        generatePlatform();
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Draw background
      const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
      gradient.addColorStop(0, '#FFB347');
      gradient.addColorStop(1, '#87CEEB');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      ctx.save();
      ctx.translate(-cameraX, 0);

      // Draw platforms
      ctx.fillStyle = "green";
      blocks.forEach(block => {
        ctx.fillRect(block.x, block.y, block.width, block.height);
      });

      // Draw enemies
      ctx.fillStyle = "red";
      enemies.forEach(enemy => {
        ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
      });

      // Draw cave
      ctx.fillStyle = "#654321";
      ctx.fillRect(cave.x, cave.y, cave.width, cave.height);
      ctx.fillStyle = "#000000";
      ctx.fillRect(cave.x + 20, cave.y, 40, cave.height);

      // Draw player
      ctx.fillStyle = player.color;
      ctx.fillRect(player.x, player.y, player.width, player.height);
      ctx.fillStyle = player.headColor;
      ctx.fillRect(player.x + 10, player.y - 15, 20, 15);

      ctx.restore();
    }

    function gameLoop() {
      if (!isDead) {
        updatePlayer();
        checkEnemyCollisions();
        checkWinCondition();
        updateGeneration();
      }
      draw();
      requestAnimationFrame(gameLoop);
    }

    // Start the game
    gameLoop();
  </script>
</body>
</html>
